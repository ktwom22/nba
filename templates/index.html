<!DOCTYPE html>
<html>
<head>
  <title>NBA Lineup Optimizer</title>
  <link rel="stylesheet" href="https://cdn.datatables.net/1.13.5/css/jquery.dataTables.min.css">
  <style>
    body { font-family: Arial; background: #f7f7f7; margin: 2em; }
    table { width: 100%; background: white; }
    th { background: #222; color: white; }
    button { padding: 10px 20px; background: #007bff; color: white; border: none; border-radius: 6px; }
  </style>
</head>
<body>
  <h2>üèÄ Player Pool</h2>
  <form id="optimizerForm" method="POST" action="/optimize">
    <input type="hidden" name="players" id="playersInput">
    <label>Number of Lineups:</label>
    <input type="number" name="player_count" value="10" min="1" max="50">

    <table id="playerTable">
      <thead>
        <tr>
          <th>Include</th>
          <th>Player</th>
          <th>Team</th>
          <th>Pos</th>
          <th>Salary</th>
          <th>Proj</th>
          <th>DVP</th>
          <th>Usage</th>
        </tr>
      </thead>
      <tbody>
        {% for p in players %}
        <tr data-idx="{{ p.idx }}">
          <td><input type="checkbox" class="includeBox" checked></td>
          <td>{{ p.player }}</td>
          <td>{{ p.team }}</td>
          <td>{{ p.pos }}</td>
          <td>${{ "%.0f"|format(p.salary) }}</td>
          <td>{{ "%.1f"|format(p.projected_points) }}</td>
          <td>{{ p.dvp }}</td>
          <td>{{ p.usuage }}</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    <button type="submit">Optimize</button>
  </form>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.5/js/jquery.dataTables.min.js"></script>
  <script>
    const table = new DataTable('#playerTable', {
      paging: true,
      searching: true,
      order: [[4, "desc"]] // Sort by Salary desc
    });

    const includeMap = {};

    $(document).on("change", ".includeBox", function() {
      const idx = $(this).closest("tr").data("idx");
      includeMap[idx] = $(this).is(":checked");
    });

    $("#optimizerForm").on("submit", function(e) {
      const allRows = [];
      $("#playerTable tbody tr").each(function() {
        const $tr = $(this);
        const idx = $tr.data("idx");
        const include = includeMap[idx] !== false; // Default true
        if (!include) return;
        const cells = $tr.children("td");
        allRows.push({
          idx: idx,
          player: cells.eq(1).text(),
          team: cells.eq(2).text(),
          pos: cells.eq(3).text(),
          salary: parseFloat(cells.eq(4).text().replace(/[$,]/g, "")),
          projected_points: parseFloat(cells.eq(5).text()),
          dvp: parseFloat(cells.eq(6).text()) || 0,
          usuage: parseFloat(cells.eq(7).text()) || 0
        });
      });
      $("#playersInput").val(JSON.stringify(allRows));
    });
  </script>
</body>
</html>
