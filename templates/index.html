<!DOCTYPE html>
<html>
<head>
    <title>Lineup Optimizer</title>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
</head>
<body>
<h2>Player Pool</h2>
<table id="players" class="display">
    <thead>
    <tr>
        <th>Include</th>
        <th>Player</th>
        <th>Team</th>
        <th>Salary</th>
        <th>Projected</th>
        <th>Usage</th>
    </tr>
    </thead>
    <tbody>
    {% for p in players %}
        <tr>
            <td><input type="checkbox" class="include-player" checked data-idx="{{ p.idx }}"></td>
            <td>{{ p.Player }}</td>
            <td>{{ p.Team }}</td>
            <td>{{ p.Salary }}</td>
            <td>{{ p['PROJECTED POINTS'] }}</td>
            <td>{{ p.Usage }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<label for="player_count">Number of lineups:</label>
<input type="number" id="player_count" value="10" min="1" max="100">
<button id="optimize-btn">Generate Lineups</button>

<h2>Top Lineups</h2>
<div id="results"></div>

<script>
    $(document).ready(function () {
        var table = $('#players').DataTable({
            "columnDefs": [
                {"orderable": false, "targets": 0}  // Disable sorting on checkbox column
            ]
        });

        $('#optimize-btn').click(function () {
            var players = [];
            table.rows().every(function () {
                var row = this.data();
                var idx = $(this.node()).find('input.include-player').data('idx');
                var include = $(this.node()).find('input.include-player').prop('checked');
                if (include) {
                    players.push({
                        "idx": idx,
                        "Player": row[1],
                        "Team": row[2],
                        "Salary": parseFloat(row[3]),
                        "PROJECTED POINTS": parseFloat(row[4]),
                        "Usage": parseFloat(row[5])
                    });
                }
            });

            var player_count = parseInt($('#player_count').val()) || 10;

            $.ajax({
                url: '/optimize',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({players: players, player_count: player_count}),
                success: function (data) {
                    $('#results').empty();
                    data.forEach(function (lineup, i) {
                        var html = `<h3>Lineup #${i+1} â€” Salary: $${lineup.total_salary.toFixed(0)} | Projected: ${lineup.projected.toFixed(1)}</h3>`;
                        html += `<table border="1"><tr><th>Player</th><th>Team</th><th>Salary</th><th>Projected</th><th>Usage</th></tr>`;
                        lineup.players.forEach(function (p) {
                            html += `<tr><td>${p.Player}</td><td>${p.Team}</td><td>${p.Salary}</td><td>${p['PROJECTED POINTS']}</td><td>${p.Usage}</td></tr>`;
                        });
                        html += `</table>`;
                        $('#results').append(html);
                    });
                }
            });
        });
    });
</script>
</body>
</html>
