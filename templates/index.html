<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Lineup Optimizer</title>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
</head>
<body>
<h1>Lineup Optimizer</h1>

<label>Number of lineups: <input type="number" id="player_count" value="10" min="1"></label>
<button id="optimize">Generate Lineups</button>

<table id="players-table" class="display">
    <thead>
        <tr>
            <th>Include</th>
            <th>Player</th>
            <th>Team</th>
            <th>Salary</th>
            <th>Projected</th>
            <th>Usage</th>
        </tr>
    </thead>
    <tbody>
    {% for p in players %}
        <tr>
            <td><input type="checkbox" class="include-player" data-idx="{{ p.idx }}" checked></td>
            <td>{{ p.Player }}</td>
            <td>{{ p.Team }}</td>
            <td>{{ p.Salary }}</td>
            <td>{{ p['PROJECTED POINTS'] }}</td>
            <td>{{ p.Usage }}</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<h2>Optimized Lineups</h2>
<div id="lineups"></div>

<script>
$(document).ready(function() {
    var table = $('#players-table').DataTable();

    $('#optimize').click(function() {
        let players = [];
        table.rows().every(function(rowIdx, tableLoop, rowLoop){
            var data = this.data();
            var include = $(this.node()).find('.include-player').prop('checked');
            players.push({
                idx: $(this.node()).find('.include-player').data('idx'),
                Player: data[1],
                Team: data[2],
                Salary: parseFloat(data[3]),
                "PROJECTED POINTS": parseFloat(data[4]),
                Usage: parseFloat(data[5]),
                Include: include
            });
        });

        $.ajax({
            url: "/optimize",
            method: "POST",
            contentType: "application/json",
            data: JSON.stringify({
                players: players,
                player_count: $("#player_count").val()
            }),
            success: function(res) {
                $("#lineups").empty();
                if(res.error){
                    $("#lineups").text("Error: " + res.error);
                    return;
                }
                res.lineups.forEach(function(l,i){
                    $("#lineups").append(`<h3>Lineup #${i+1} â€” Salary: $${l.salary.toFixed(0)} | Projected: ${l.proj.toFixed(1)}</h3>`);
                    let html = '<table border="1"><tr><th>Player</th><th>Team</th><th>Salary</th><th>Projected</th><th>Usage</th></tr>';
                    l.lineup.forEach(function(p){
                        html += `<tr><td>${p.Player}</td><td>${p.Team}</td><td>${p.Salary}</td><td>${p['PROJECTED POINTS']}</td><td>${p.Usage}</td></tr>`;
                    });
                    html += '</table>';
                    $("#lineups").append(html);
                });
            }
        });
    });
});
</script>
</body>
</html>
